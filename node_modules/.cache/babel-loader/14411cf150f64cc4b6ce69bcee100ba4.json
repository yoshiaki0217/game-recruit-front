{"ast":null,"code":"import _taggedTemplateLiteral from \"/usr/src/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nimport _defineProperty from \"/usr/src/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _objectSpread from \"/usr/src/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"/usr/src/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"/usr/src/app/src/pages/MyPageEdit.jsx\",\n    _this = this,\n    _s = $RefreshSig$(),\n    _templateObject,\n    _templateObject2;\n\nimport { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport { useHistory } from 'react-router-dom';\nimport styled from 'styled-components';\nimport { PrimaryButton, Footer, HeaderBackButton } from '../components/index';\nimport DefaultIcon from '../images/default-icon.png';\nimport Joi from 'joi-browser';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nvar MyPageEdit = function MyPageEdit(props) {\n  _s();\n\n  var userId = props.location.state.userId;\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      userDetail = _useState2[0],\n      setUserDetail = _useState2[1];\n\n  var _useState3 = useState(DefaultIcon),\n      _useState4 = _slicedToArray(_useState3, 2),\n      thumbnail = _useState4[0],\n      setThumbnail = _useState4[1];\n\n  var history = useHistory();\n\n  var _useState5 = useState([]),\n      _useState6 = _slicedToArray(_useState5, 2),\n      errorMessages = _useState6[0],\n      setErrorMessages = _useState6[1];\n\n  var _useState7 = useState([]),\n      _useState8 = _slicedToArray(_useState7, 2),\n      formData = _useState8[0],\n      setFormData = _useState8[1];\n\n  useEffect(function () {\n    var unmounted = false;\n\n    if (!unmounted) {\n      getUserDetail(userId);\n      unmounted = true;\n    }\n  }, [userId]); // 友だちのデータ取得\n\n  var getUserDetail = function getUserDetail(userId) {\n    var url = process.env.REACT_APP_BACKEND_PATH;\n    axios.get(url + '/api/mypage/' + userId).then(function (res) {\n      var _res$data$results = res.data.results,\n          id = _res$data$results.id,\n          icon = _res$data$results.icon,\n          user_name = _res$data$results.user_name,\n          game = _res$data$results.game,\n          introduction = _res$data$results.introduction;\n      setUserDetail(res.data.results);\n      setThumbnail(res.data.results.icon === null ? DefaultIcon : res.data.results.icon);\n      setFormData({\n        'id': id,\n        'icon': icon ? icon : '',\n        'user_name': user_name,\n        'game': game ? game : '',\n        'introduction': introduction ? introduction : ''\n      });\n    }).catch(function (error) {\n      console.log(error);\n    });\n  };\n\n  var validate = function validate(formData) {\n    var schema = Joi.object({\n      id: Joi.number().required(),\n      icon: Joi,\n      // エラー内容を一気に出すやり方（メッセージをオーバーライドする方法がわからないため保留）\n      // user_name: Joi.string()\n      //   .max(256)\n      //   .required(),\n      // game: Joi.string()\n      // .max(256)\n      // .required(),\n      // introduction: Joi.string()\n      // .max(5000)\n      // .required(),\n      // エラー内容を一つ一つ出すやり方\n      user_name: Joi.string().max(256).required().error(function (errors) {\n        errors.forEach(function (err) {\n          switch (err.type) {\n            case \"any.empty\":\n              err.message = \"＊ユーザー名は必須です\";\n              break;\n\n            case \"string.max\":\n              err.message = \"\\uFF0A\\u30E6\\u30FC\\u30B6\\u30FC\\u540D\\u306F\".concat(err.context.limit, \"\\u6587\\u5B57\\u4EE5\\u5185\\u3067\\u8A2D\\u5B9A\\u3057\\u3066\\u304F\\u3060\\u3055\\u3044\");\n              break;\n\n            default:\n              break;\n          }\n        });\n        return new Error(errors);\n      }),\n      game: Joi.string().max(5000).allow('').error(function (errors) {\n        errors.forEach(function (err) {\n          switch (err.type) {\n            case \"string.base\":\n              err.message = \"＊ゲーム名は文字列を入力してください\";\n              break;\n\n            case \"string.max\":\n              err.message = \"\\uFF0A\\u30B2\\u30FC\\u30E0\\u540D\\u306F\".concat(err.context.limit, \"\\u6587\\u5B57\\u4EE5\\u5185\\u3067\\u8A2D\\u5B9A\\u3057\\u3066\\u304F\\u3060\\u3055\\u3044\");\n              break;\n\n            default:\n              break;\n          }\n        });\n        return new Error(errors);\n      }),\n      introduction: Joi.string().max(5000).allow('').error(function (errors) {\n        errors.forEach(function (err) {\n          console.log(err.type);\n\n          switch (err.type) {\n            case \"string.base\":\n              err.message = \"＊自己紹介は文字列を入力してください\";\n              break;\n\n            case \"string.max\":\n              err.message = \"\\uFF0A\\u81EA\\u5DF1\\u7D39\\u4ECB\\u306F\".concat(err.context.limit, \"\\u6587\\u5B57\\u4EE5\\u5185\\u3067\\u8A2D\\u5B9A\\u3057\\u3066\\u304F\\u3060\\u3055\\u3044\");\n              break;\n\n            default:\n              break;\n          }\n        });\n        return new Error(errors);\n      })\n    }); // バリデーション実行\n\n    var result = schema.validate(formData, {\n      abortEarly: false\n    });\n    var errors = []; // エラー内容を一気に出すやり方（メッセージをオーバーライドする方法がわからないため保留）\n    // if(!result.error) return null;\n    // for(let item of result.error.details) {\n    //   errors.push(item.message);\n    // }\n    // エラー内容を一つ一つ出すやり方\n\n    if (result.error) {\n      errors = result.error.message.split(',');\n    } else {\n      errors = null;\n    }\n\n    return errors;\n  };\n\n  var onChangeEvent = function onChangeEvent(e) {\n    var name = e.target.name;\n    setFormData(_objectSpread(_objectSpread({}, formData), {}, _defineProperty({}, name, e.target.value)));\n  };\n\n  var changeIcon = function changeIcon() {\n    var icon = document.getElementById('icon');\n    icon.click();\n  };\n\n  var setImage = function setImage(e) {\n    var name = e.target.name;\n    var files = e.target;\n\n    if (files.files[0] !== undefined) {\n      var file = files.files[0];\n      var type = file.type;\n\n      if (type !== \"image/jpeg\" && type !== \"image/png\" && type !== \"image/webp\") {\n        alert(\"選択されたファイルはアップロードできません\");\n        return false;\n      }\n\n      setFormData(_objectSpread(_objectSpread({}, formData), {}, _defineProperty({}, name, file)));\n\n      if (type.startsWith(\"image/\")) {\n        setThumbnail(window.URL.createObjectURL(file));\n      }\n    }\n  };\n\n  var sendUserDetail = function sendUserDetail() {\n    var url = process.env.REACT_APP_BACKEND_PATH;\n    var formDatas = new FormData();\n    var errors = validate(formData);\n\n    if (errors) {\n      setErrorMessages(errors);\n      return false;\n    }\n\n    formDatas.append(\"id\", formData.id);\n    formDatas.append(\"user_name\", formData.user_name);\n    formDatas.append(\"icon\", formData.icon);\n    formDatas.append(\"game\", formData.game);\n    formDatas.append(\"introduction\", formData.introduction);\n    var config = {\n      headers: {\n        \"content-type\": \"multipart/form-data\"\n      }\n    };\n\n    if (!errors) {\n      axios.post(url + '/api/mypage/edit', formDatas, config).then(function (res) {\n        setUserDetail(res.data.results);\n        history.push('/mypage/' + userId);\n      }).catch(function (error) {\n        // エラーメッセージの配列を用意\n        var messages = []; // レスポンスをオブジェクトから配列に変換\n\n        var arr = Object.entries(error.response.data.errors); // レスポンスの配列からメッセージだけを取り出し、エラーメッセージの配列にセット\n\n        arr.forEach(function (value) {\n          messages.push(value[1][0]);\n        }); // 表示用の配列にセット\n\n        setErrorMessages(messages);\n      });\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(MyPageEditSection, {\n      className: \"h-screen bg-sub\",\n      children: [/*#__PURE__*/_jsxDEV(HeaderBackButton, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 9\n      }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mt-16 mb-20\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: errorMessages.length === 0 ? 'hidden' : 'bg-red-100 w-80 mx-auto p-1 mb-2',\n          children: /*#__PURE__*/_jsxDEV(\"ul\", {\n            className: \"mx-auto px-3 text-red-600\",\n            children: errorMessages.map(function (item, index) {\n              return /*#__PURE__*/_jsxDEV(\"li\", {\n                children: item\n              }, index, false, {\n                fileName: _jsxFileName,\n                lineNumber: 245,\n                columnNumber: 21\n              }, _this);\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 241,\n            columnNumber: 13\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 240,\n          columnNumber: 11\n        }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"px-4 flex justify-center items-center\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"img\", {\n              className: \"rounded-full my-3 mx-auto\",\n              src: thumbnail,\n              onClick: changeIcon,\n              width: \"150\",\n              height: \"150\",\n              alt: \"\\u30D7\\u30ED\\u30D5\\u30A3\\u30FC\\u30EB\\u753B\\u50CF\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 253,\n              columnNumber: 15\n            }, _this), /*#__PURE__*/_jsxDEV(\"input\", {\n              style: {\n                display: 'none'\n              },\n              name: \"icon\",\n              id: \"icon\",\n              type: \"file\",\n              onChange: setImage\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 254,\n              columnNumber: 15\n            }, _this), /*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"bg-indigo-600 bg-opacity-0 text-center text-xl p-1 border-b border-main\",\n              type: \"text\",\n              name: \"user_name\",\n              placeholder: \"\\u30E6\\u30FC\\u30B6\\u30FC\\u540D\",\n              defaultValue: userDetail.user_name,\n              onChange: onChangeEvent\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 255,\n              columnNumber: 15\n            }, _this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 252,\n            columnNumber: 13\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 251,\n          columnNumber: 11\n        }, _this), /*#__PURE__*/_jsxDEV(\"section\", {\n          className: \"\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"psot-item w-80 bg-white p-4 my-5 mx-auto\",\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"post-list-item truncate\",\n              children: \"\\u30B2\\u30FC\\u30E0:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 261,\n              columnNumber: 15\n            }, _this), /*#__PURE__*/_jsxDEV(TextArea, {\n              className: \"p-1 w-full\",\n              cols: \"30\",\n              rows: \"2\",\n              name: \"game\",\n              placeholder: \"\\u30B2\\u30FC\\u30E0\\u306E\\u7A2E\\u985E\",\n              defaultValue: userDetail.game,\n              onChange: onChangeEvent\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 262,\n              columnNumber: 15\n            }, _this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: \"\\u81EA\\u5DF1\\u7D39\\u4ECB:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 263,\n              columnNumber: 15\n            }, _this), /*#__PURE__*/_jsxDEV(TextArea, {\n              className: \"p-1 w-full\",\n              cols: \"30\",\n              rows: \"10\",\n              name: \"introduction\",\n              placeholder: \"\\u81EA\\u5DF1\\u7D39\\u4ECB\\u6587\",\n              defaultValue: userDetail.introduction,\n              onChange: onChangeEvent\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 264,\n              columnNumber: 15\n            }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex justify-center\",\n              children: /*#__PURE__*/_jsxDEV(PrimaryButton, {\n                styles: \"bg-sub text-sm p-2 m-2 w-4.5/10\",\n                onClick: sendUserDetail,\n                children: \"\\u4FDD\\u5B58\\u3059\\u308B\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 266,\n                columnNumber: 17\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 265,\n              columnNumber: 15\n            }, _this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 260,\n            columnNumber: 13\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 259,\n          columnNumber: 11\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 9\n      }, _this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 272,\n        columnNumber: 9\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 7\n    }, _this)\n  }, void 0, false);\n};\n\n_s(MyPageEdit, \"gQscd0SLapNPNpQhXc0VBg5gFDQ=\", false, function () {\n  return [useHistory];\n});\n\n_c = MyPageEdit;\nvar MyPageEditSection = styled.section(_templateObject || (_templateObject = _taggedTemplateLiteral([\"\\n  overflow-y: scroll;\\n\"])));\n_c2 = MyPageEditSection;\nvar TextArea = styled.textarea(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"\\n  resize: none;\\n\"])));\n_c3 = TextArea;\nexport default MyPageEdit;\n\nvar _c, _c2, _c3;\n\n$RefreshReg$(_c, \"MyPageEdit\");\n$RefreshReg$(_c2, \"MyPageEditSection\");\n$RefreshReg$(_c3, \"TextArea\");","map":{"version":3,"sources":["/usr/src/app/src/pages/MyPageEdit.jsx"],"names":["useState","useEffect","axios","useHistory","styled","PrimaryButton","Footer","HeaderBackButton","DefaultIcon","Joi","MyPageEdit","props","userId","location","state","userDetail","setUserDetail","thumbnail","setThumbnail","history","errorMessages","setErrorMessages","formData","setFormData","unmounted","getUserDetail","url","process","env","REACT_APP_BACKEND_PATH","get","then","res","data","results","id","icon","user_name","game","introduction","catch","error","console","log","validate","schema","object","number","required","string","max","errors","forEach","err","type","message","context","limit","Error","allow","result","abortEarly","split","onChangeEvent","e","name","target","value","changeIcon","document","getElementById","click","setImage","files","undefined","file","alert","startsWith","window","URL","createObjectURL","sendUserDetail","formDatas","FormData","append","config","headers","post","push","messages","arr","Object","entries","response","length","map","item","index","display","MyPageEditSection","section","TextArea","textarea"],"mappings":"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","sourcesContent":["import { useState, useEffect} from 'react';\nimport axios from 'axios'\nimport { useHistory } from 'react-router-dom'\nimport styled from 'styled-components'\nimport {\n  PrimaryButton,\n  Footer,\n  HeaderBackButton\n} from '../components/index'\nimport DefaultIcon from '../images/default-icon.png'\nimport Joi from 'joi-browser';\n\nconst MyPageEdit = (props) => {\n  const userId = props.location.state.userId;\n  const [userDetail, setUserDetail] = useState([]);\n  const [thumbnail, setThumbnail] = useState(DefaultIcon);\n  const history = useHistory();\n  const [errorMessages, setErrorMessages] = useState([])\n  const [formData, setFormData] = useState([])\n\n  useEffect(() => {\n    let unmounted = false;\n    if(!unmounted) {\n      getUserDetail(userId);\n      unmounted = true\n    }\n  },[userId])\n\n  // 友だちのデータ取得\n  const getUserDetail = (userId) => {\n    let url = process.env.REACT_APP_BACKEND_PATH;\n\n    axios.get(url + '/api/mypage/' + userId)\n    .then((res) => {\n      const { id, icon, user_name, game, introduction } = res.data.results;\n      setUserDetail(res.data.results);\n      setThumbnail(res.data.results.icon === null ? DefaultIcon : res.data.results.icon);\n      setFormData({\n        'id' : id,\n        'icon' : icon ? icon : '',\n        'user_name' : user_name,\n        'game' : game ? game : '',\n        'introduction' : introduction ? introduction : '',\n      });\n    })\n    .catch((error) => {\n      console.log(error)\n    })\n  }\n\n  const validate = (formData) => {\n    const schema = Joi.object({\n      id: Joi.number()\n        .required(),\n  \n      icon: Joi,\n  \n      // エラー内容を一気に出すやり方（メッセージをオーバーライドする方法がわからないため保留）\n      // user_name: Joi.string()\n      //   .max(256)\n      //   .required(),\n  \n      // game: Joi.string()\n      // .max(256)\n      // .required(),\n      \n      // introduction: Joi.string()\n      // .max(5000)\n      // .required(),\n  \n      // エラー内容を一つ一つ出すやり方\n      user_name: Joi.string()\n        .max(256)\n        .required()\n        .error(errors => {\n          errors.forEach(err => {\n            switch (err.type) {\n              case \"any.empty\":\n                err.message = \"＊ユーザー名は必須です\";\n                break;\n              case \"string.max\":\n                err.message = `＊ユーザー名は${err.context.limit}文字以内で設定してください`;\n                break;\n              default:\n                break;\n            }\n          });\n          return new Error(errors);\n        }),\n  \n      game: Joi.string()\n        .max(5000)\n        .allow('')\n        .error(errors => {\n          errors.forEach(err => {\n            switch (err.type) {\n              case \"string.base\":\n                err.message = \"＊ゲーム名は文字列を入力してください\";\n                break;\n              case \"string.max\":\n                err.message = `＊ゲーム名は${err.context.limit}文字以内で設定してください`;\n                break;\n              default:\n                break;\n            }\n          });\n          return new Error(errors);\n        }),\n  \n      introduction: Joi.string()\n        .max(5000)\n        .allow('')\n        .error(errors => {\n          errors.forEach(err => {\n            console.log(err.type);\n            switch (err.type) {\n              case \"string.base\":\n                err.message = \"＊自己紹介は文字列を入力してください\";\n                break;\n              case \"string.max\":\n                err.message = `＊自己紹介は${err.context.limit}文字以内で設定してください`;\n                break;\n              default:\n                break;\n            }\n          });\n          return new Error(errors);\n        }),\n    })\n  \n    // バリデーション実行\n    const result = schema.validate(formData, {abortEarly: false});\n    let errors = [];\n    \n    // エラー内容を一気に出すやり方（メッセージをオーバーライドする方法がわからないため保留）\n    // if(!result.error) return null;\n    // for(let item of result.error.details) {\n    //   errors.push(item.message);\n    // }\n  \n    // エラー内容を一つ一つ出すやり方\n    if(result.error) {\n      errors = result.error.message.split(',');\n    } else {\n      errors = null;\n    }\n  \n    return errors;\n  }\n\n  const onChangeEvent = (e) => {\n    const name = e.target.name;\n    setFormData({\n      ...formData,\n      [name]: e.target.value\n    });\n  }\n\n  const changeIcon = () => {\n    let icon = document.getElementById('icon');\n    icon.click();\n  }\n\n\n  const setImage = (e) => {\n    const name = e.target.name;\n    const files = e.target;\n\n    if (files.files[0] !== undefined) {\n      const file = files.files[0]\n      const type = file.type\n      if (\n          type !== \"image/jpeg\" &&\n          type !== \"image/png\" &&\n          type !== \"image/webp\"\n      ) {\n          alert(\"選択されたファイルはアップロードできません\")\n          return false\n      }\n      setFormData({\n        ...formData,\n        [name]: file\n      });\n      if (type.startsWith(\"image/\")) {\n        setThumbnail(window.URL.createObjectURL(file))\n      }\n    }\n  }\n\n  const sendUserDetail = () => {\n    let url = process.env.REACT_APP_BACKEND_PATH;\n    let formDatas = new FormData();\n\n    const errors = validate(formData);\n\n    if(errors) {\n      setErrorMessages(errors);\n      return false;\n    }\n\n    formDatas.append(\"id\", formData.id)\n    formDatas.append(\"user_name\", formData.user_name)\n    formDatas.append(\"icon\", formData.icon)\n    formDatas.append(\"game\", formData.game)\n    formDatas.append(\"introduction\", formData.introduction)\n\n    const config = {\n      headers: {\n        \"content-type\": \"multipart/form-data\"\n      }\n    }\n\n    if(!errors) {\n      axios.post(url + '/api/mypage/edit', formDatas, config)\n      .then((res) => {\n        setUserDetail(res.data.results);\n        history.push('/mypage/' + userId);\n      })\n      .catch((error) => {\n        // エラーメッセージの配列を用意\n        let messages = [];\n        // レスポンスをオブジェクトから配列に変換\n        let arr = Object.entries(error.response.data.errors);\n        // レスポンスの配列からメッセージだけを取り出し、エラーメッセージの配列にセット\n        arr.forEach(function (value) {\n          messages.push(value[1][0]);\n        })\n        // 表示用の配列にセット\n        setErrorMessages(messages);\n      })\n    }\n  }\n\n  return (\n    <>\n      <MyPageEditSection className=\"h-screen bg-sub\">\n        <HeaderBackButton />\n\n        <div className=\"mt-16 mb-20\">\n          <div className={ errorMessages.length === 0 ? 'hidden' : 'bg-red-100 w-80 mx-auto p-1 mb-2' }>\n            <ul className=\"mx-auto px-3 text-red-600\">\n              {\n              errorMessages.map((item, index) => {\n                return (\n                    <li key={ index }>{ item }</li>\n                    )\n                  })\n              }\n            </ul>\n          </div>\n          <div className=\"px-4 flex justify-center items-center\">\n            <div>\n              <img className=\"rounded-full my-3 mx-auto\" src={ thumbnail } onClick={ changeIcon } width=\"150\" height=\"150\" alt=\"プロフィール画像\" />\n              <input style={{display: 'none'}} name=\"icon\" id=\"icon\" type=\"file\" onChange={setImage} />\n              <input className=\"bg-indigo-600 bg-opacity-0 text-center text-xl p-1 border-b border-main\" type=\"text\" name=\"user_name\" placeholder=\"ユーザー名\" defaultValue={ userDetail.user_name } onChange={ onChangeEvent } />\n            </div>\n          </div>\n\n          <section className=\"\">\n            <div className=\"psot-item w-80 bg-white p-4 my-5 mx-auto\">\n              <p className=\"post-list-item truncate\">ゲーム:</p>\n              <TextArea className=\"p-1 w-full\" cols=\"30\" rows=\"2\" name=\"game\" placeholder=\"ゲームの種類\" defaultValue={ userDetail.game } onChange={ onChangeEvent }></TextArea>\n              <p>自己紹介:</p>\n              <TextArea className=\"p-1 w-full\" cols=\"30\" rows=\"10\" name=\"introduction\" placeholder=\"自己紹介文\" defaultValue={ userDetail.introduction } onChange={ onChangeEvent }></TextArea>\n              <div className=\"flex justify-center\">\n                <PrimaryButton styles={ \"bg-sub text-sm p-2 m-2 w-4.5/10\" } onClick={ sendUserDetail }>保存する</PrimaryButton>\n              </div>\n            </div>\n          </section>\n        </div>\n\n        <Footer />\n      </MyPageEditSection>\n    </>\n  )\n}\n\nconst MyPageEditSection = styled.section`\n  overflow-y: scroll;\n`\n\nconst TextArea = styled.textarea`\n  resize: none;\n`\n\nexport default MyPageEdit\n\n"]},"metadata":{},"sourceType":"module"}